<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Satisfaction Dashboard</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
header { text-align: center; margin-bottom: 20px; }
.banner { background: #4caf50; color: white; text-align: center; font-size: 20px; padding: 10px; animation: scroll 10s linear infinite; }
@keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
#metric-cards { display: flex; gap: 20px; justify-content: center; margin-bottom: 20px; }
.metric-card { background: #f4f4f4; padding: 15px; border-radius: 8px; text-align: center; width: 150px; }
.heatmap-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-top: 20px; }
.heatmap-cell { padding: 10px; color: #fff; text-align: center; border-radius: 4px; font-weight: bold; cursor: pointer; }
.chart-container { width: 90%; margin: 20px auto; }
button { margin: 10px; padding: 10px 15px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; }
button:hover { background: #45a049; }
</style>
https://cdn.jsdelivr.net/npm/chart.js
https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js</script>
</head>
<body>
<header>
<h1>Executive Dashboard</h1>
<h2>Comprehensive Analytics for Customer Satisfaction</h2>
</header>
<div class="banner">LIVE DATA</div>

<section id="metric-cards"></section>

<div class="chart-container">
<canvas id="trendChart"></canvas>
</div>

<h3>Performance Heatmap</h3>
<div id="heatmapGrid" class="heatmap-grid"></div>

<div style="text-align:center;">
<button onclick="exportCSV()">Export CSV</button>
<button onclick="exportPDF()">Export PDF</button>
<button onclick="refreshData()">Refresh Data</button>
</div>

<script>
const sheetUrl = 'https://cors-anywhere.herokuapp.com/https://docs.google.com/spreadsheets/d/e/1fAVab8nrLB9Ee_Y4tAj0ynto9bqkRhJeTGmbhDvlcp8/pub?output=csv';
const questionLabels = [
 'On a scale of one to ten, with ten being Excellent and one being Poor, how would you rate your overall experience with the company',
 'On a scale of 1 to 10 how satisfied are you with the installation and project management of the project?',
 'On a scale of 1 to 10 how satisfied are you with the engagement and responsiveness of our Sales Team?',
 'On a scale of 1 to 10 how satisfied are you with the quality and speed of our service and support?',
 'On a scale of 1 to 10, how effective is Sharp’s communication with you in regard to, (clarity, timeliness, transparency)?',
 'How likely are you to recommend Sharp products/experience to your colleagues?”',
 'How likely are you to purchase dvLED from Sharp in the future?',
 'On a scale of 1 to 10, how satisfied are you with Sharp’s dvLED product offerings (features, availability,)?',
 'On a scale of 1 to 10, how would you rate the overall value Sharp provides compared to other manufacturers?'
];

async function fetchData() {
 try {
   const response = await fetch(sheetUrl);
   const text = await response.text();
   return parseCSV(text);
 } catch (error) {
   console.error('Fetch failed, using sample data', error);
   return [];
 }
}

function parseCSV(text) {
 const rows = text.split('\n').map(r => r.split(','));
 const headers = rows.shift();
 return rows.filter(r => r.length === headers.length).map(row =>
   Object.fromEntries(row.map((val, i) => [headers[i], val]))
 );
}

function calculateMetrics(data) {
 let total = 0, count = 0;
 data.forEach(row => {
   questionLabels.forEach(q => {
     const val = parseFloat(row[q]);
     if (!isNaN(val)) { total += val; count++; }
   });
 });
 const avgScore = (total / count).toFixed(2);
 document.getElementById('metric-cards').innerHTML = `
   <div class='metric-card'><h3>Avg Score</h3><p>${avgScore}</p></div>
   <div class='metric-card'><h3>Risk Index</h3><p>${calculateRiskIndex(data)}%</p></div>
 `;
}

function calculateRiskIndex(data) {
 let lowScores = 0, totalScores = 0;
 data.forEach(row => {
   questionLabels.forEach(q => {
     const val = parseFloat(row[q]);
     if (!isNaN(val)) {
       totalScores++;
       if (val <= 6) lowScores++;
     }
   });
 });
 return ((lowScores / totalScores) * 100).toFixed(2);
}

function generateHeatmap(data) {
 const container = document.getElementById('heatmapGrid');
 container.innerHTML = '';
 questionLabels.forEach(q => {
   let sum = 0, count = 0;
   data.forEach(row => {
     const val = parseFloat(row[q]);
     if (!isNaN(val)) { sum += val; count++; }
   });
   const avg = (sum / count).toFixed(1);
   const color = avg >= 8 ? '#4caf50' : avg >= 6 ? '#ff9800' : '#f44336';
   const cell = document.createElement('div');
   cell.className = 'heatmap-cell';
   cell.style.backgroundColor = color;
   cell.textContent = `${q}: ${avg}`;
   cell.addEventListener('click', () => showDrillDown(q, data));
   container.appendChild(cell);
 });
}

function showDrillDown(question, data) {
 const modal = document.createElement('div');
 modal.style.position = 'fixed';
 modal.style.top = '0'; modal.style.left = '0';
 modal.style.width = '100%'; modal.style.height = '100%';
 modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
 modal.style.display = 'flex'; modal.style.justifyContent = 'center'; modal.style.alignItems = 'center';
 modal.style.zIndex = '9999';
 const content = document.createElement('div');
 content.style.backgroundColor = '#fff'; content.style.padding = '20px'; content.style.borderRadius = '8px';
 content.style.maxHeight = '80%'; content.style.overflowY = 'auto'; content.style.width = '400px';
 const title = document.createElement('h3');
 title.textContent = `Responses for: ${question}`;
 content.appendChild(title);
 const list = document.createElement('ul');
 data.forEach(row => {
   const li = document.createElement('li');
   li.textContent = `${row['First name'] || ''} ${row['Last name'] || ''} - Score: ${row[question]}`;
   list.appendChild(li);
 });
 content.appendChild(list);
 const closeBtn = document.createElement('button');
 closeBtn.textContent = 'Close';
 closeBtn.style.marginTop = '10px';
 closeBtn.addEventListener('click', () => modal.remove());
 content.appendChild(closeBtn);
 modal.appendChild(content);
 document.body.appendChild(modal);
}

function exportCSV() {
 fetchData().then(data => {
   const headers = Object.keys(data[0]);
   const rows = data.map(row => headers.map(h => row[h]).join(','));
   const csv = [headers.join(','), ...rows].join('\n');
   const blob = new Blob([csv], { type: 'text/csv' });
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url; a.download = 'dashboard_data.csv'; a.click();
 });
}

function exportPDF() {
 const { jsPDF } = window.jspdf;
 const doc = new jsPDF();
 doc.text('Executive Dashboard Report', 10, 10);
 doc.text(document.getElementById('metric-cards').textContent, 10, 20);
 doc.save('dashboard_report.pdf');
}

function refreshData() {
 init();
}

async function init() {
 const data = await fetchData();
 calculateMetrics(data);
 generateHeatmap(data);
 generateTrendChart(data);
}

function generateTrendChart(data) {
 const ctx = document.getElementById('trendChart').getContext('2d');
 const labels = data.map(d => d['Submitted At'] || 'N/A');
 const avgScores = data.map(d => {
   let sum = 0, count = 0;
   questionLabels.forEach(q => {
     const val = parseFloat(d[q]);
     if (!isNaN(val)) { sum += val; count++; }
   });
   return count ? (sum / count).toFixed(2) : null;
 });
 new Chart(ctx, {
   type: 'line',
   data: { labels, datasets: [{ label: 'Avg Score', data: avgScores, borderColor: '#4caf50', fill: false }] },
   options: { responsive: true, scales: { y: { beginAtZero: true, max: 10 } } }
 });
}

init();
setInterval(refreshData, 300000); // Auto-refresh every 5 minutes
</script>
</body>
</html>
